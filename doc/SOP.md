# üìù ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á LINE Expense Bot (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤)

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
‡∏ö‡∏≠‡∏ó‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `!co: ‡∏Å‡∏≤‡πÅ‡∏ü 95 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô` ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Supabase

---

## 1Ô∏è‚É£ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°

### ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ:
- üóÇÔ∏è **Supabase** ‚Üí [https://supabase.com](https://supabase.com)
- ‚òÅÔ∏è **Cloudflare** ‚Üí [https://dash.cloudflare.com](https://dash.cloudflare.com)
- üí¨ **LINE Developer Console** ‚Üí [https://developers.line.biz/console](https://developers.line.biz/console)
- üîß **Postman** (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ä‡πâ Desktop App)

### ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
```
!co: ‡∏Å‡∏≤‡πÅ‡∏ü 95 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô
```

---

## 2Ô∏è‚É£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase

### 2.1 ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå
1. ‡πÄ‡∏Ç‡πâ‡∏≤ Supabase ‚Üí ‡∏Ñ‡∏•‡∏¥‡∏Å **New Project**
2. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô `line-expense`) ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
3. **‡∏à‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ:**
   - **Project URL** (‡πÄ‡∏ä‡πà‡∏ô `https://xxxxx.supabase.co`)
   - **Service Role Key**

> ‚ö†Ô∏è **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** Project URL ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡πä‡∏≠‡∏õ‡∏à‡∏≤‡∏Å Settings ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á

### 2.2 ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **SQL Editor**
2. ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î **Run:**

```sql
create extension if not exists pgcrypto;

create table public.ledger_entries (
  id uuid primary key default gen_random_uuid(),
  message_id text unique,
  line_user_id text,
  kind text default 'expense',
  amount numeric(12,2),
  currency text default 'THB',
  category text,
  account text,
  merchant text,
  note text,
  occurred_at timestamptz not null default now(),
  recorded_at timestamptz not null default now(),
  source text default 'line',
  status text default 'ok',
  raw_text text,
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

create index if not exists idx_le_user_time on public.ledger_entries(line_user_id, occurred_at desc);
alter table public.ledger_entries enable row level security;
```

3. ‡∏Å‡∏î **Refresh** ‚Üí ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `ledger_entries`

### 2.3 ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Postman
1. ‡πÄ‡∏õ‡∏¥‡∏î Postman ‚Üí **New Request** ‚Üí Method = **POST**
2. **URL:**
   ```
   https://<PROJECT>.supabase.co/rest/v1/ledger_entries?on_conflict=message_id
   ```

3. **Headers:**
   ```
   apikey: <SERVICE_ROLE_KEY>
   Authorization: Bearer <SERVICE_ROLE_KEY>
   Content-Type: application/json
   Prefer: resolution=merge-duplicates,return=representation
   ```

4. **Body (raw JSON):**
   ```json
   [{
     "message_id": "postman-001",
     "line_user_id": "Udebug",
     "raw_text": "insert via postman",
     "amount": 100,
     "occurred_at": "2025-09-09T00:00:00Z",
     "recorded_at": "2025-09-09T00:00:00Z",
     "source": "line",
     "status": "ok"
   }]
   ```

5. ‡∏Å‡∏î **Send** ‚Üí ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏à‡∏∞‡πÑ‡∏î‡πâ **201 Created** ‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Table Editor

#### üö® Error ‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢:
- **404** = URL ‡∏ú‡∏¥‡∏î
- **403** = Key ‡∏ú‡∏¥‡∏î
- **ENOTFOUND** = Project URL ‡∏™‡∏∞‡∏Å‡∏î‡∏ú‡∏¥‡∏î

---

## 3Ô∏è‚É£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Cloudflare Worker

### 3.1 ‡∏™‡∏£‡πâ‡∏≤‡∏á Worker
1. ‡πÑ‡∏õ Cloudflare Dashboard ‚Üí **Workers & Pages** ‚Üí **Create Application** ‚Üí **Create Worker**
2. ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠ ‡πÄ‡∏ä‡πà‡∏ô `line-expense-worker`

### 3.2 ‡πÉ‡∏™‡πà Environment Variables
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Settings** ‚Üí **Variables & Secrets** ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°:
   ```
   SUPABASE_URL = https://<project>.supabase.co
   SERVICE_ROLE_KEY = Service Role Key
   LINE_CHANNEL_ACCESS_TOKEN = Token ‡∏à‡∏≤‡∏Å LINE Developer
   LINE_CHANNEL_SECRET = Secret ‡∏à‡∏≤‡∏Å LINE Developer
   ```

### 3.3 ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡πâ‡∏î Worker
1. ‡πÄ‡∏õ‡∏¥‡∏î **Quick Edit**
2. ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î `worker.js` (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ Dictionary ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ)
3. ‡∏Å‡∏î **Save & Deploy**

### 3.4 ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö LINE
1. ‡πÑ‡∏õ LINE Developer Console ‚Üí **Messaging API** ‚Üí **Webhook URL**
2. ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Worker (‡πÄ‡∏ä‡πà‡∏ô `https://<worker>.workers.dev`)
3. ‡∏Å‡∏î **Verify** ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô **Success**
4. ‡πÄ‡∏õ‡∏¥‡∏î **Use webhook** = **Enabled**

---

## 4Ô∏è‚É£ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö End-to-End

1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° Bot
2. ‡∏û‡∏¥‡∏°‡∏û‡πå: `!co: ‡∏Å‡∏≤‡πÅ‡∏ü 95 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô`
3. ‡∏ö‡∏≠‡∏ó‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß: 95 ‡∏ö‡∏≤‡∏ó ‚Ä¶"
4. ‡πÑ‡∏õ‡∏î‡∏π‡πÉ‡∏ô Supabase ‚Üí **Table Editor** ‚Üí ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤

---

## 8Ô∏è‚É£ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Dictionary (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡πâ‡∏≤‡∏ô/‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà)

### 8.1 ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î
1. **Cloudflare** ‚Üí **Workers & Pages** ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Worker ‚Üí **Quick Edit**

[Screenshot: Quick Edit interface ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î worker.js]

### 8.2 ‡∏´‡∏≤ Dictionary Section
1. ‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ `ALIAS_RULES` ‡∏´‡∏£‡∏∑‡∏≠ `CATEGORY_PREFIX`
2. ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:

```javascript
const ALIAS_RULES = [
  { kw: /‡∏¢‡∏≤‡πÇ‡∏¢‡∏≠‡∏¥|yayoi/i, category:'food', merchant:'Yayoi' },
  { kw: /‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ö‡∏±‡∏Ñ|starbucks/i, category:'food', merchant:'Starbucks' },
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
];
```

### 8.3 ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡πâ‡∏≤‡∏ô/‡∏´‡∏°‡∏ß‡∏î‡πÉ‡∏´‡∏°‡πà
**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°:**
```javascript
{ kw: /‡πÅ‡∏°‡∏Ñ|mcdonald/i, category:'food', merchant:'McDonalds' },
{ kw: /‡∏õ‡∏ï‡∏ó|ptt/i, category:'fuel', merchant:'PTT' },
{ kw: /‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠/i, category:'education', merchant:'Bookstore' },
```

### 8.4 Deploy ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
1. ‡∏Ñ‡∏•‡∏¥‡∏Å **Save and deploy**
2. ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‚Üí ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà

**‚úÖ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:** ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

[Screenshot: ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Table Editor ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÉ‡∏´‡∏°‡πà]

---

## 9Ô∏è‚É£ ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 9.1 ‡∏ú‡πà‡∏≤‡∏ô UI (‡∏á‡πà‡∏≤‡∏¢)
1. **Supabase** ‚Üí **Table Editor** ‚Üí **ledger_entries**
2. **Filter** ‚Üí ‡∏û‡∏¥‡∏°‡∏û‡πå `raw_text ilike %test%`
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ‚Üí ‡∏Ñ‡∏•‡∏¥‡∏Å **Delete**

[Screenshot: Table Editor ‡∏û‡∏£‡πâ‡∏≠‡∏° Filter ‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° Delete]

### 9.2 ‡∏ú‡πà‡∏≤‡∏ô SQL (‡∏•‡∏ö‡∏´‡∏°‡∏î)
1. **SQL Editor** ‚Üí **New query**
2. ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î:
```sql
delete from public.ledger_entries
where raw_text ilike '%test%' or raw_text ilike '%postman%';
```
3. ‡∏Ñ‡∏•‡∏¥‡∏Å **Run**

**‚úÖ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á---

## üîü ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ Supabase Edge Functions (‡πÅ‡∏ú‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)

### 10.1 ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° CLI
1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Node.js (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
2. ‡πÄ‡∏õ‡∏¥‡∏î Terminal/Command Prompt
3. ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:
```bash
npm install -g supabase
supabase login
```

[Screenshot: Terminal ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Supabase CLI]

### 10.2 ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
1. ‡πÉ‡∏ô Terminal:
```bash
supabase functions new line-expense
```
2. ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `supabase/functions/line-expense/index.ts`

### 10.3 ‡∏¢‡πâ‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å Worker ‚Üí Function
1. ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå `index.ts`
2. ‡∏ô‡∏≥ logic ‡∏û‡∏≤‡∏£‡πå‡∏™/insert ‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å Worker ‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô Deno handler
3. ‡∏õ‡∏£‡∏±‡∏ö syntax ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (fetch API ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)

### 10.4 ‡∏ï‡∏±‡πâ‡∏á Secrets
```bash
supabase secrets set \
  SUPABASE_URL=https://<project>.supabase.co \
  SERVICE_ROLE_KEY=<key> \
  LINE_CHANNEL_ACCESS_TOKEN=<token> \
  LINE_CHANNEL_SECRET=<secret>
```

### 10.5 Deploy
```bash
supabase functions deploy line-expense
```

‡∏à‡∏∞‡πÑ‡∏î‡πâ URL: `https://<project>.functions.supabase.co/line-expense`

### 10.6 ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Webhook URL
1. ‡∏ô‡∏≥ URL ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏ô **LINE Developer Console**
2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Verify ‚Üí Success

**‚úÖ ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ Edge Functions:**
- Latency ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ Cloudflare
- Logs ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö Supabase
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡πà‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤

---

## 1Ô∏è‚É£1Ô∏è‚É£ Troubleshooting ‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏£‡πá‡∏ß

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ | ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ |
|-------|--------|--------|
| üî¥ **LINE Verify Failed** | Worker URL ‡∏ú‡∏¥‡∏î/Worker offline | ‡πÄ‡∏ä‡πá‡∏Ñ Worker Status ‡πÅ‡∏•‡∏∞ URL |
| üî¥ **Cloudflare 404/PGRST125** | Path Supabase ‡∏ú‡∏¥‡∏î | ‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà `/rest/v1/ledger_entries` |
| üî¥ **403 Forbidden** | ‡πÉ‡∏ä‡πâ anon key/key ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ | ‡πÉ‡∏ä‡πâ Service Role Key ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á |
| üî¥ **‡∏ö‡∏≠‡∏ó‡∏ï‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤ DB** | Database connection ‡∏ú‡∏¥‡∏î | ‡∏î‡∏π Cloudflare Logs ‡∏´‡∏≤ PostgREST error |
| üî¥ **‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏á‡∏µ‡∏¢‡∏ö** | ‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà `!co:` | ‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `!co:` ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° |
| üî¥ **amount = null** | Bot parse ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å | ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° |
| üî¥ **duplicate error** | ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡πâ‡∏≥ | ‡∏õ‡∏Å‡∏ï‡∏¥ - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô duplicate record |

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏π Logs ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Debug:
1. **Cloudflare** ‚Üí **Workers & Pages** ‚Üí Worker ‚Üí **Logs**
2. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‚Üí ‡∏î‡∏π Error ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
3. ‡∏´‡∏≤ Error Code ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô

---

## üì¶ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Project ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Cloudflare Worker:
```
line-copilot-ledger/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ worker.js          # ‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡∏•‡∏±‡∏Å + Dictionary
‚îÇ   ‚îî‚îÄ‚îÄ dict.js           # (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡πÅ‡∏¢‡∏Å Dictionary
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ .env.example      # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Environment
‚îÇ   ‚îî‚îÄ‚îÄ wrangler.toml     # Cloudflare config (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ CLI)
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ SOP.md            # ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ
‚îÇ   ‚îú‚îÄ‚îÄ README.md         # ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ
‚îÇ   ‚îî‚îÄ‚îÄ CHANGELOG.md      # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ postman/
        ‚îî‚îÄ‚îÄ LINE-Expense.postman_collection.json
```

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Supabase Edge Functions:
```
line-copilot-ledger/
‚îú‚îÄ‚îÄ supabase/
‚îÇ   ‚îú‚îÄ‚îÄ functions/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ line-expense/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ index.ts       # Function ‡∏´‡∏•‡∏±‡∏Å
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ deno.json      # Deno config
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dict.ts        # Dictionary module
‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 001_create_ledger.sql  # ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
‚îÇ   ‚îî‚îÄ‚îÄ config.toml            # Supabase config
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ ... (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô)
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ legacy-worker.js       # Worker ‡πÄ‡∏Å‡πà‡∏≤ (‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ)
```

### ‡πÑ‡∏ü‡∏•‡πå `.env.example`:
```bash
# Supabase
SUPABASE_URL=https://your-project.supabase.co
SERVICE_ROLE_KEY=your-service-role-key

# LINE
LINE_CHANNEL_ACCESS_TOKEN=your-access-token
LINE_CHANNEL_SECRET=your-channel-secret

# Cloudflare (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ)
WORKER_URL=https://your-worker.workers.dev
```

### ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå Package.json (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å):
```json
{
  "name": "line-expense-bot",
  "version": "1.0.0",
  "scripts": {
    "dev": "supabase functions serve",
    "deploy": "supabase functions deploy line-expense",
    "test": "deno test --allow-all",
    "setup": "supabase start && supabase db reset"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.0.0"
  }
}
```

### üìÇ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢:
```
line-copilot-ledger/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ worker.js                    # ‚úÖ ‡∏ï‡∏±‡∏ß‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà deploy
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ SOP.md                       # ‚úÖ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ
‚îÇ   ‚îú‚îÄ‚îÄ README.md                    # ‚úÖ ‡∏â‡∏ö‡∏±‡∏ö‡∏¢‡πà‡∏≠ 5 ‡∏ô‡∏≤‡∏ó‡∏µ
‚îÇ   ‚îî‚îÄ‚îÄ CHANGELOG.md                 # ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Dict/‡πÇ‡∏Ñ‡πâ‡∏î
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ postman/
‚îÇ       ‚îú‚îÄ‚îÄ LINE-Expense.postman_collection.json     # ‚úÖ Import ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
‚îÇ       ‚îî‚îÄ‚îÄ LINE-Expense.postman_environment.json    # ‚úÖ ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ .env.example                 # ‚úÖ Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°
```

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏ö‡∏≠‡∏ó LINE ‡∏ó‡∏µ‡πà:

### üéØ **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏•‡∏±‡∏Å:**
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô LINE
- ‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ï‡∏≤‡∏°‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ)
- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Supabase Database
- ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°

### üí¨ **‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
- **‡πÅ‡∏ä‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß:** `‡∏Å‡∏≤‡πÅ‡∏ü 95 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô`
- **‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°:** `!co: ‡∏Å‡∏≤‡πÅ‡∏ü 95 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô`

### üîß **‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤:**
- ‡πÅ‡∏Å‡πâ Dictionary ‡πÉ‡∏ô Cloudflare Worker ‚Üí Deploy ‡πÉ‡∏´‡∏°‡πà
- ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Supabase Table Editor
- ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô Edge Functions ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°

### üöÄ **‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ:**
1. ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Dictionary
2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (CSV/Excel)
3. ‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ Supabase Edge Functions
4. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢

**üéâ ‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏¥‡∏ô‡∏î‡∏µ! ‡∏ö‡∏≠‡∏ó LINE Expense ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß**

---

*üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2025 - ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π Logs ‡πÉ‡∏ô Cloudflare ‡∏´‡∏£‡∏∑‡∏≠ Supabase ‡πÄ‡∏û‡∏∑‡πà‡∏≠ Debug ‡πÑ‡∏î‡πâ*
